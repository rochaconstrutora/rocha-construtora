<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Painel Administrativo - Rocha Construtora</title>

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0f172a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Rocha App">
  <link rel="apple-touch-icon" href="assets/img/logo_preto.png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet" />

  <link rel="stylesheet" href="assets/css/style.css" />

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <script defer src="assets/js/supabaseClient.js"></script>
  <script defer src="assets/js/auth.js"></script>
  <script defer src="assets/js/utils.js"></script>
  <script defer src="assets/js/obras.js"></script>
  <script defer src="assets/js/funcoes.js"></script>
  <script defer src="assets/js/funcionarios.js"></script>
  <script defer src="assets/js/dashboard.js"></script>
  <script defer src="assets/js/usuarios.js"></script>
  <script defer src="assets/js/relatorios.js"></script>
  <script defer src="assets/js/modulos_admin.js"></script>
</head>

<body onload="protegerPagina(['admin', 'financeiro'])">

  <div class="sidebar-overlay" onclick="toggleMenu()"></div>

  <div class="app-shell">
    <!-- ====== SIDEBAR ====== -->
    <aside class="md-sidebar" id="main-sidebar">
      <div class="md-brand">
        <div class="md-brand-logo">
          <img src="assets/img/logo_branco.png" alt="Logo Rocha Construtora">
        </div>
        <div>
          <div class="md-brand-title">Rocha Construtora</div>
          <div class="md-brand-sub">Painel Administrativo</div>
        </div>
      </div>

      <div class="md-nav-title">Gest√£o</div>
      <nav class="md-nav">
        <div class="menu-item active" data-target="dashboard" onclick="mostrarSecao('dashboard')">
          <span class="material-symbols-outlined">dashboard</span>
          <span>Dashboard</span>
        </div>
        <div class="menu-item" data-target="obras" onclick="mostrarSecao('obras')">
          <span class="material-symbols-outlined">apartment</span>
          <span>Obras</span>
        </div>
        <div class="menu-item" data-target="funcoes" onclick="mostrarSecao('funcoes')">
          <span class="material-symbols-outlined">badge</span>
          <span>Fun√ß√µes</span>
        </div>
        <div class="menu-item" data-target="funcionarios" onclick="mostrarSecao('funcionarios')">
          <span class="material-symbols-outlined">engineering</span>
          <span>Funcion√°rios</span>
        </div>
        <div class="menu-item" data-target="ponto" onclick="mostrarSecao('ponto')">
          <span class="material-symbols-outlined">event_available</span>
          <span>Gest√£o de Ponto</span>
        </div>
        <div class="menu-item" data-target="usuarios" onclick="mostrarSecao('usuarios')">
          <span class="material-symbols-outlined">group</span>
          <span>Usu√°rios</span>
        </div>
        <div class="menu-item" data-target="caixa" onclick="mostrarSecao('caixa')">
          <span class="material-symbols-outlined">payments</span>
          <span>Caixa da Obra</span>
        </div>
        <div class="menu-item" data-target="relatorios" onclick="mostrarSecao('relatorios')">
          <span class="material-symbols-outlined">insights</span>
          <span>Relat√≥rios RH</span>
        </div>
        <div class="menu-item" data-target="diario" onclick="mostrarSecao('diario')">
          <span class="material-symbols-outlined">menu_book</span>
          <span>Di√°rio de Obra</span>
        </div>
        <div class="menu-item" data-target="materiais" onclick="mostrarSecao('materiais')">
          <span class="material-symbols-outlined">inventory_2</span>
          <span>Materiais</span>
          <span class="menu-badge" id="badge-materiais" style="display:none">0</span>
        </div>
      </nav>

      <div class="menu-item logout" id="btn-logout">
        <span class="material-symbols-outlined">logout</span>
        <span>Sair</span>
      </div>
    </aside>

    <!-- ====== MAIN ====== -->
    <main class="md-main">
      <header class="md-header">
        <button class="mobile-menu-btn" onclick="toggleMenu()">
          <span class="material-symbols-outlined">menu</span>
        </button>
        <div class="md-header-left">
          <h1>Rocha Construtora</h1>
          <span class="md-header-breadcrumb" id="header-breadcrumb">Dashboard</span>
        </div>
        <div class="md-header-right">
          <div class="md-chip">
            <span class="material-symbols-outlined" style="font-size:14px;">verified_user</span>
            <span id="chip-perfil">Usu√°rio</span>
          </div>
          <div class="md-user-pill">
            <span class="avatar" id="avatar-inicial">U</span>
            <span id="header-nome-usuario">Admin</span>
          </div>
        </div>
      </header>

      <section class="md-content">

        <!-- ==================== DASHBOARD ==================== -->
        <section id="sec-dashboard" class="md-section active">
          <div class="md-section-header">
            <div>
              <h2>Vis√£o Geral</h2>
              <p id="dash-resumo" style="margin:2px 0 0; font-size:13px; color:#64748b;">Carregando dados...</p>
            </div>
          </div>

          <div class="dash-stats">
            <div class="stat-card">
              <div class="stat-icon" style="background:#e0f2fe; color:#0284c7;">
                <span class="material-symbols-outlined">apartment</span>
              </div>
              <div>
                <span class="stat-label">Obras Ativas</span>
                <h3 id="dash-obras">‚Äî</h3>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon" style="background:#f0fdf4; color:#16a34a;">
                <span class="material-symbols-outlined">groups</span>
              </div>
              <div>
                <span class="stat-label">Funcion√°rios</span>
                <h3 id="dash-funcionarios">‚Äî</h3>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon" style="background:#fef3c7; color:#d97706;">
                <span class="material-symbols-outlined">payments</span>
              </div>
              <div>
                <span class="stat-label">Caixa (M√™s)</span>
                <h3 id="dash-caixa" style="font-size:15px;">R$ 0,00</h3>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon" style="background:#f3e8ff; color:#9333ea;">
                <span class="material-symbols-outlined">calendar_month</span>
              </div>
              <div>
                <span class="stat-label">Di√°rias (M√™s)</span>
                <h3 id="dash-diarias">‚Äî</h3>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon" style="background:#fce7f3; color:#db2777;">
                <span class="material-symbols-outlined">paid</span>
              </div>
              <div>
                <span class="stat-label">Custo Total (M√™s)</span>
                <h3 id="dash-custo" style="font-size:15px;">R$ 0,00</h3>
              </div>
            </div>
          </div>

          <div class="dash-split">
            <div class="md-card chart-card">
              <div class="card-header">
                <h3><span class="material-symbols-outlined" style="font-size:18px;color:#64748b;">bar_chart</span> Di√°rias por Obra</h3>
              </div>
              <div class="chart-wrapper"><canvas id="dashDiariasPorObra"></canvas></div>
            </div>
            <div class="dash-side-col">
              <div class="md-card action-card" onclick="mostrarSecao('materiais')" title="Ver materiais pendentes">
                <div class="action-header">
                  <h3><span class="material-symbols-outlined" style="font-size:16px;">inventory_2</span> Materiais</h3>
                  <span class="material-symbols-outlined" style="font-size:18px;">arrow_forward</span>
                </div>
                <p id="dash-materiais" class="big-number">‚Äî</p>
                <small style="color:#94a3b8;">Pendentes de compra</small>
              </div>
              <div class="md-card info-card">
                <h3><span class="material-symbols-outlined" style="font-size:16px;">engineering</span> Total RH (M√™s)</h3>
                <p id="dash-valor" class="big-number" style="color:#1e88e5;">R$ 0,00</p>
                <small style="color:#94a3b8;">Lan√ßamentos de ponto</small>
              </div>
            </div>
          </div>

          <!-- Custo completo por obra -->
          <div class="md-card mt-4">
            <div class="card-header">
              <h3>
                <span class="material-symbols-outlined" style="font-size:18px;color:#64748b;">paid</span>
                Custo Completo por Obra (M√™s)
              </h3>
              <small class="text-muted" id="dash-custo-periodo"></small>
            </div>
            <div class="dash-split" style="margin-top:10px;">
              <div style="flex:1.2; min-height:260px;">
                <div class="chart-wrapper" style="height:260px;"><canvas id="dashCustoPorObra"></canvas></div>
              </div>
              <div style="flex:1; overflow:auto; max-height:300px;">
                <table class="md-table">
                  <thead><tr><th>Obra</th><th>RH</th><th>Despesas</th><th>Total</th></tr></thead>
                  <tbody id="dash-custo-por-obra">
                    <tr><td colspan="4" style="text-align:center;padding:16px;color:#94a3b8;">Carregando...</td></tr>
                  </tbody>
                </table>
                <div style="text-align:right;font-size:14px;font-weight:700;margin-top:10px;padding-right:4px;">
                  Total Geral: <span id="dash-custo-total-geral" style="color:#0f172a;">R$ 0,00</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Intelig√™ncia de prazos -->
          <div class="md-card mt-4">
            <h3>
              <span class="material-symbols-outlined" style="font-size:18px;color:#64748b;">timelapse</span>
              Intelig√™ncia de Prazos
            </h3>
            <div class="table-wrapper">
              <table class="md-table">
                <thead>
                  <tr>
                    <th>Obra</th>
                    <th>In√≠cio</th>
                    <th>Prev. T√©rmino</th>
                    <th style="min-width:140px;">Progresso</th>
                    <th>Status Autom√°tico</th>
                  </tr>
                </thead>
                <tbody id="lista-tempo-obras">
                  <tr><td colspan="5" style="text-align:center;padding:16px;color:#94a3b8;">Carregando...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- ==================== OBRAS ==================== -->
        <section id="sec-obras" class="md-section">
          <div class="md-section-header"><h2>Obras</h2></div>
          <div class="md-card">
            <h3><span class="material-symbols-outlined" style="font-size:17px;color:#64748b;">add_circle</span> Gerenciar Obra</h3>
            <form id="form-obras" class="grid-form">
              <input type="hidden" id="obra-id">
              <div class="md-field"><label>Nome da Obra</label><input type="text" id="obra-nome" placeholder="Ex: Resid√™ncia Silva"></div>
              <div class="md-field"><label>CEP (Busca Auto)</label><input type="text" id="obra-cep" class="mask-cep" placeholder="00000-000"></div>
              <div class="md-field"><label>Endere√ßo (Rua)</label><input type="text" id="obra-rua"></div>
              <div class="md-field"><label>Bairro</label><input type="text" id="obra-bairro"></div>
              <div class="md-field"><label>Cidade</label><input type="text" id="obra-cidade"></div>
              <div class="md-field" style="display:grid; grid-template-columns:70px 1fr; gap:10px;">
                <div><label>UF</label><input type="text" id="obra-estado" maxlength="2"></div>
                <div><label>N√∫mero</label><input type="text" id="obra-numero"></div>
              </div>
              <div class="md-field"><label>Status</label>
                <select id="obra-status"><option value="ativa">Ativa</option><option value="inativa">Inativa</option></select>
              </div>
              <div class="md-field"><label>Data de In√≠cio</label><input type="date" id="obra-inicio"></div>
              <div class="md-field"><label>Fim (Previs√£o)</label><input type="date" id="obra-fim"></div>
              <div class="md-field"><label>% Conclus√£o</label><input type="number" id="obra-perc" min="0" max="100" placeholder="0 a 100"></div>
              <div class="md-actions span-all">
                <button type="submit" class="btn-primary">
                  <span class="material-symbols-outlined" style="font-size:16px;">save</span> Salvar Obra
                </button>
              </div>
            </form>
          </div>
          <div class="md-card mt-4">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; flex-wrap:wrap; gap:8px;">
              <div class="search-bar">
                <span class="material-symbols-outlined">search</span>
                <input type="text" id="busca-obras" placeholder="Buscar obra...">
              </div>
              <small class="text-muted" id="count-lista-obras"></small>
            </div>
            <div class="table-wrapper">
              <table class="md-table">
                <thead><tr><th>Nome</th><th>Local</th><th>Status</th><th>Prazo</th><th>% / Situa√ß√£o</th><th>A√ß√µes</th></tr></thead>
                <tbody id="lista-obras"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- ==================== FUN√á√ïES ==================== -->
        <section id="sec-funcoes" class="md-section">
          <div class="md-section-header"><h2>Fun√ß√µes e Cargos</h2></div>
          <div class="md-card">
            <h3><span class="material-symbols-outlined" style="font-size:17px;color:#64748b;">add_circle</span> Gerenciar Fun√ß√£o</h3>
            <form id="form-funcoes">
              <input type="hidden" id="funcao-id">
              <div class="md-field"><label>Nome do Cargo</label><input type="text" id="funcao-nome" placeholder="Ex: Pedreiro, Servente, Encanador..."></div>
              <div class="grid-form" style="grid-template-columns:1fr 1fr 1fr; margin-top:12px;">
                <div class="md-field"><label>Valor Meia Di√°ria</label><input type="text" id="funcao-meia" class="mask-money" placeholder="R$ 0,00"></div>
                <div class="md-field"><label>Valor Di√°ria Completa</label><input type="text" id="funcao-diaria" class="mask-money" placeholder="R$ 0,00"></div>
                <div class="md-field"><label>Valor Hora Extra</label><input type="text" id="funcao-hora" class="mask-money" placeholder="R$ 0,00"></div>
              </div>
              <button type="submit" class="btn-primary w-100" style="margin-top:15px;">
                <span class="material-symbols-outlined" style="font-size:16px;">save</span> Salvar Fun√ß√£o
              </button>
            </form>
          </div>
          <div class="md-card mt-4">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; flex-wrap:wrap; gap:8px;">
              <div class="search-bar">
                <span class="material-symbols-outlined">search</span>
                <input type="text" id="busca-funcoes" placeholder="Buscar fun√ß√£o...">
              </div>
              <small class="text-muted" id="count-lista-funcoes"></small>
            </div>
            <div class="table-wrapper">
              <table class="md-table">
                <thead><tr><th>Cargo</th><th>Meia</th><th>Di√°ria</th><th>H. Extra</th><th>Status</th><th>A√ß√µes</th></tr></thead>
                <tbody id="lista-funcoes"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- ==================== FUNCION√ÅRIOS ==================== -->
        <section id="sec-funcionarios" class="md-section">
          <div class="md-section-header"><h2>Funcion√°rios</h2></div>
          <div class="md-card">
            <h3><span class="material-symbols-outlined" style="font-size:17px;color:#64748b;">person_add</span> Cadastrar / Editar Funcion√°rio</h3>
            <form id="form-funcionarios" class="grid-form">
              <input type="hidden" id="funcionario-id">
              <div class="md-field span-2"><label>Nome Completo</label><input type="text" id="funcionario-nome" placeholder="Nome completo"></div>
              <div class="md-field"><label>Apelido</label><input type="text" id="funcionario-apelido" placeholder="Como √© chamado"></div>
              <div class="md-field"><label>CPF (Valida√ß√£o Real)</label><input type="text" id="funcionario-cpf" class="mask-cpf" placeholder="000.000.000-00"></div>
              <div class="md-field"><label>Fun√ß√£o / Cargo</label><select id="funcionario-funcao"></select></div>
              <div class="md-field"><label>Obra Atual</label><select id="funcionario-obra"></select></div>

              <div class="md-field"><label>CEP</label><input type="text" id="funcionario-cep" class="mask-cep" placeholder="00000-000"></div>
              <div class="md-field"><label>Rua / Logradouro</label><input type="text" id="funcionario-rua"></div>
              <div class="md-field"><label>Bairro</label><input type="text" id="funcionario-bairro"></div>
              <div class="md-field"><label>N√∫mero</label><input type="text" id="funcionario-numero"></div>
              <div class="md-field"><label>Cidade</label><input type="text" id="funcionario-cidade"></div>
              <div class="md-field"><label>Estado (UF)</label><input type="text" id="funcionario-estado" maxlength="2"></div>

              <div class="md-field"><label>Chave PIX</label><input type="text" id="funcionario-pix" placeholder="CPF, celular, e-mail ou aleat√≥ria"></div>
              <div class="md-field"><label>Conta Banc√°ria</label><input type="text" id="funcionario-conta" placeholder="Banco / Ag / Conta"></div>
              <div class="md-actions span-all">
                <button type="submit" class="btn-primary">
                  <span class="material-symbols-outlined" style="font-size:16px;">save</span> Salvar Funcion√°rio
                </button>
              </div>
            </form>
          </div>
          <div class="md-card mt-4">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; flex-wrap:wrap; gap:8px;">
              <div class="search-bar">
                <span class="material-symbols-outlined">search</span>
                <input type="text" id="busca-funcionarios" placeholder="Buscar funcion√°rio...">
              </div>
              <small class="text-muted" id="count-lista-funcionarios"></small>
            </div>
            <div class="table-wrapper">
              <table class="md-table">
                <thead><tr><th>Nome / CPF</th><th>Apelido</th><th>Fun√ß√£o</th><th>Obra</th><th>Status</th><th>A√ß√µes</th></tr></thead>
                <tbody id="lista-funcionarios"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- ==================== PONTO ==================== -->
        <section id="sec-ponto" class="md-section">
          <div class="md-section-header"><h2>Gest√£o de Ponto / Di√°rias</h2></div>

          <!-- Card edi√ß√£o inline -->
          <div class="md-card" id="card-edit-ponto" style="display:none; border-left:4px solid #f59e0b; margin-bottom:20px;">
            <h3 style="color:#d97706;"><span class="material-symbols-outlined" style="font-size:18px;">edit</span> Editar Registro</h3>
            <form id="form-ponto-admin" class="grid-form">
              <input type="hidden" id="ponto-admin-id">
              <div class="md-field"><label>Funcion√°rio</label><input type="text" id="ponto-admin-nome" readonly></div>
              <div class="md-field"><label>Data</label><input type="date" id="ponto-admin-data" readonly></div>
              <div class="md-field"><label>Tipo</label>
                <select id="ponto-admin-tipo">
                  <option value="DIARIA">Di√°ria Completa</option>
                  <option value="MEIA">Meia Di√°ria</option>
                </select>
              </div>
              <div class="md-field"><label>Valor (R$)</label><input type="text" id="ponto-admin-valor" class="mask-money"></div>
              <div class="md-actions span-2">
                <button type="button" class="btn-primary" onclick="salvarEdicaoPontoAdmin()">
                  <span class="material-symbols-outlined" style="font-size:16px;">save</span> Salvar Altera√ß√µes
                </button>
                <button type="button" class="btn-ghost" onclick="cancelarEdicaoPonto()">Cancelar</button>
              </div>
            </form>
          </div>

          <div class="md-card">
            <div class="grid-form" style="align-items:end;">
              <div class="md-field"><label>M√™s de Refer√™ncia</label><input type="month" id="ponto-filtro-mes"></div>
              <div class="md-field"><label>Filtrar Obra</label><select id="ponto-filtro-obra"><option value="">Todas</option></select></div>
              <div class="md-field"><label>Filtrar Funcion√°rio</label><select id="ponto-filtro-func"><option value="">Todos</option></select></div>
              <button class="btn-primary" onclick="carregarPontosAdmin()" style="height:40px;">
                <span class="material-symbols-outlined" style="font-size:16px;">filter_alt</span> Filtrar
              </button>
            </div>
          </div>

          <div class="md-card mt-4">
            <div style="display:flex; justify-content:flex-end; margin-bottom:8px;">
              <small class="text-muted" id="count-tabela-ponto"></small>
            </div>
            <div class="table-wrapper">
              <table class="md-table">
                <thead><tr><th>Data</th><th>Funcion√°rio</th><th>Obra</th><th>Tipo</th><th>Valor + Extras</th><th>A√ß√µes</th></tr></thead>
                <tbody id="tabela-ponto-admin"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- ==================== USU√ÅRIOS ==================== -->
        <section id="sec-usuarios" class="md-section">
          <div class="md-section-header"><h2>Usu√°rios do Sistema</h2></div>
          <div class="md-card">
            <h3><span class="material-symbols-outlined" style="font-size:17px;color:#64748b;">person_add</span> Criar / Editar Usu√°rio</h3>
            <form id="form-usuario">
              <div class="grid-form">
                <div class="md-field"><label>Nome</label><input type="text" id="usuario-nome" placeholder="Nome completo"></div>
                <div class="md-field"><label>E-mail (Login)</label><input type="email" id="usuario-email" placeholder="email@empresa.com"></div>
                <div class="md-field" id="usuario-senha-box"><label>Senha</label><input type="password" id="usuario-senha" placeholder="M√≠nimo 6 caracteres"></div>
                <div class="md-field"><label>Perfil / Permiss√£o</label>
                  <select id="usuario-tipo">
                    <option value="admin">Administrador</option>
                    <option value="responsavel">Respons√°vel (Mestre de Obra)</option>
                    <option value="financeiro">Financeiro</option>
                    <option value="rh">RH</option>
                  </select>
                </div>
                <div class="md-field" id="usuario-obra-box" style="display:none;">
                  <label>Vincular √† Obra</label>
                  <select id="usuario-obra"></select>
                </div>
              </div>
              <div class="md-actions" style="margin-top:14px;">
                <button type="submit" class="btn-primary">
                  <span class="material-symbols-outlined" style="font-size:16px;">save</span> Criar Usu√°rio
                </button>
              </div>
            </form>
          </div>
          <div class="md-card mt-4">
            <div class="table-wrapper">
              <table class="md-table">
                <thead><tr><th>Nome</th><th>Login</th><th>Tipo</th><th>Obra</th><th>Status</th><th>A√ß√µes</th></tr></thead>
                <tbody id="lista-usuarios"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- ==================== CAIXA ==================== -->
        <section id="sec-caixa" class="md-section">
          <div class="md-section-header"><h2>Caixa da Obra</h2></div>

          <div class="md-card">
            <h3><span class="material-symbols-outlined" style="font-size:17px;color:#64748b;">add_circle</span> Lan√ßamento Administrativo</h3>
            <p class="text-muted" style="margin:0 0 14px;">Campos com <strong>*</strong> s√£o obrigat√≥rios.</p>
            <form id="form-caixa-admin" class="grid-form">
              <input type="hidden" id="caixa-admin-id">
              <div class="md-field"><label>Obra *</label><select id="caixa-admin-obra" required><option value="">Selecione...</option></select></div>
              <div class="md-field"><label>Data *</label><input type="date" id="caixa-admin-data" required></div>
              <div class="md-field">
                <label>Categoria *</label>
                <select id="caixa-admin-categoria" required>
                  <option value="">Selecione...</option>
                  <option value="Materiais Ordin√°rios">Materiais Ordin√°rios</option>
                  <option value="Combust√≠vel">Combust√≠vel</option>
                  <option value="Compras Extras">Compras Extras</option>
                  <option value="Ferramentas">Ferramentas</option>
                  <option value="Servi√ßos">Servi√ßos</option>
                  <option value="Transporte">Transporte</option>
                  <option value="Alimenta√ß√£o">Alimenta√ß√£o</option>
                  <option value="Outros">Outros</option>
                </select>
              </div>
              <div class="md-field"><label>Descri√ß√£o *</label><input type="text" id="caixa-admin-desc" required placeholder="Ex: Compra de cimento ‚Äî NF 1234"></div>
              <div class="md-field"><label>Valor (R$) *</label><input type="text" id="caixa-admin-valor" required class="mask-money"></div>
              <div class="md-field"><label>Fornecedor / Loja</label><input type="text" id="caixa-admin-fornecedor" placeholder="Ex: Posto X / Dep√≥sito Y"></div>
              <div class="md-field"><label>N¬∫ Documento / NF</label><input type="text" id="caixa-admin-documento" placeholder="Ex: NF 12345"></div>
              <div class="md-field">
                <label>Forma de Pagamento *</label>
                <select id="caixa-admin-pagamento" required>
                  <option value="">Selecione...</option>
                  <option value="Dinheiro">Dinheiro</option>
                  <option value="Pix">Pix</option>
                  <option value="Cart√£o de D√©bito">Cart√£o de D√©bito</option>
                  <option value="Cart√£o de Cr√©dito">Cart√£o de Cr√©dito</option>
                </select>
              </div>
              <div class="md-field" id="caixa-admin-parcelas-box" style="display:none;">
                <label>Parcelas (Cr√©dito) *</label>
                <input type="number" id="caixa-admin-parcelas" min="1" step="1" placeholder="Ex: 3">
              </div>
              <div class="md-field span-all">
                <label>Observa√ß√µes</label>
                <textarea id="caixa-admin-observacoes" rows="3" placeholder="Detalhes extras (opcional)"></textarea>
              </div>
              <div class="md-field span-all">
                <label>Comprovantes (foto/PDF)</label>
                <input type="file" id="caixa-admin-comprovantes" multiple accept="image/*,application/pdf">
                <small class="text-muted">Voc√™ pode anexar 1 ou mais arquivos. (Opcional)</small>
              </div>
              <div class="md-actions span-all">
                <button type="submit" class="btn-primary">
                  <span class="material-symbols-outlined" style="font-size:16px;">save</span> Salvar Lan√ßamento
                </button>
              </div>
            </form>
          </div>

          <div class="md-card mt-4">
            <div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:14px; border-bottom:1px solid #f1f5f9; padding-bottom:14px;">
              <div class="md-field" style="flex:1; min-width:140px;"><label>Filtrar Obra</label><select id="caixa-filtro-obra"><option value="">Todas</option></select></div>
              <div class="md-field" style="flex:1; min-width:130px;"><label>Filtrar M√™s</label><input type="month" id="caixa-filtro-mes"></div>
              <div class="md-field" style="flex:1; min-width:160px;">
                <label>Filtrar Categoria</label>
                <select id="caixa-filtro-categoria">
                  <option value="">Todas</option>
                  <option value="Materiais Ordin√°rios">Materiais Ordin√°rios</option>
                  <option value="Combust√≠vel">Combust√≠vel</option>
                  <option value="Compras Extras">Compras Extras</option>
                  <option value="Ferramentas">Ferramentas</option>
                  <option value="Servi√ßos">Servi√ßos</option>
                  <option value="Transporte">Transporte</option>
                  <option value="Alimenta√ß√£o">Alimenta√ß√£o</option>
                  <option value="Outros">Outros</option>
                </select>
              </div>
              <button class="btn-primary" onclick="carregarCaixaAdmin()" style="height:40px; align-self:flex-end;">
                <span class="material-symbols-outlined" style="font-size:16px;">filter_alt</span> Filtrar
              </button>
            </div>

            <!-- Resumo custo -->
            <div style="background:#f8fafc; border:1px solid #e2e8f0; border-radius:10px; padding:16px; margin-bottom:16px;">
              <div style="display:flex; justify-content:space-between; align-items:flex-start; gap:10px; flex-wrap:wrap; margin-bottom:12px;">
                <div>
                  <h3 style="margin:0; font-size:14px;">
                    <span class="material-symbols-outlined" style="font-size:18px;vertical-align:middle;margin-right:4px;color:#64748b;">paid</span>
                    Custo Completo no Per√≠odo
                  </h3>
                  <small class="text-muted">Usa o mesmo filtro de Obra e M√™s acima.</small>
                </div>
                <div style="display:flex; gap:8px; flex-wrap:wrap;">
                  <button id="btn-caixa-detalhado" class="btn-ghost btn-sm" onclick="caixaAbrirRelatorioCusto()">Ver RH detalhado</button>
                  <button class="btn-secondary btn-sm" onclick="caixaGerarCustoExcel()">
                    <span class="material-symbols-outlined" style="font-size:14px;">table_view</span> Excel
                  </button>
                  <button class="btn-primary btn-sm" onclick="caixaGerarCustoPDF()">
                    <span class="material-symbols-outlined" style="font-size:14px;">picture_as_pdf</span> PDF
                  </button>
                </div>
              </div>
              <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); gap:10px;">
                <div class="md-card" style="margin:0; padding:14px;">
                  <h3 style="font-size:12px; margin:0 0 6px;">Despesas (Caixa)</h3>
                  <p id="caixa-total-despesas" style="font-size:20px; font-weight:700; color:#ef4444; margin:0;">R$ 0,00</p>
                  <small class="text-muted">Lan√ßamentos do caixa</small>
                </div>
                <div class="md-card" style="margin:0; padding:14px;">
                  <h3 style="font-size:12px; margin:0 0 6px;">M√£o de Obra (RH)</h3>
                  <p id="caixa-total-rh" style="font-size:20px; font-weight:700; color:#1e88e5; margin:0;">R$ 0,00</p>
                  <small class="text-muted">Somat√≥rio dos pontos</small>
                </div>
                <div class="md-card" style="margin:0; padding:14px; border-left:4px solid #0f172a;">
                  <h3 style="font-size:12px; margin:0 0 6px;">Total (Custo Completo)</h3>
                  <p id="caixa-total-geral" style="font-size:20px; font-weight:700; color:#0f172a; margin:0;">R$ 0,00</p>
                  <small class="text-muted">Despesas + RH</small>
                </div>
              </div>

              <div class="table-wrapper" style="margin-top:12px;">
                <table class="md-table">
                  <thead><tr><th>Categoria</th><th style="text-align:right;">Total</th></tr></thead>
                  <tbody id="caixa-cats-tabela">
                    <tr><td colspan="2" style="text-align:center;padding:12px;color:#94a3b8;">Selecione uma obra e m√™s.</td></tr>
                  </tbody>
                </table>
              </div>

              <div id="caixa-custo-detalhado" style="display:none; margin-top:14px; border-top:1px dashed #e2e8f0; padding-top:14px;">
                <h3 style="margin:0 0 10px; font-size:13px;">
                  <span class="material-symbols-outlined" style="font-size:16px;vertical-align:middle;color:#64748b;margin-right:4px;">badge</span>
                  RH Detalhado por Funcion√°rio
                </h3>
                <div class="table-wrapper">
                  <table class="md-table">
                    <thead><tr><th>Funcion√°rio</th><th style="text-align:center;">Dias</th><th style="text-align:center;">Extras (h)</th><th style="text-align:right;">Total</th></tr></thead>
                    <tbody id="caixa-custo-rh-detalhe">
                      <tr><td colspan="4" style="text-align:center;color:#94a3b8;">Clique em "Ver RH detalhado".</td></tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- Tabela lan√ßamentos -->
            <div style="display:flex; justify-content:flex-end; margin-bottom:8px;">
              <small class="text-muted" id="count-tabela-caixa"></small>
            </div>
            <div class="table-wrapper">
              <table class="md-table">
                <thead><tr><th>Data</th><th>Obra</th><th>Categoria</th><th>Descri√ß√£o</th><th>Pagamento</th><th>Valor</th><th>Comp.</th><th>A√ß√µes</th></tr></thead>
                <tbody id="tabela-caixa-admin"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- ==================== RELAT√ìRIOS ==================== -->
        <section id="sec-relatorios" class="md-section">
          <div class="md-section-header"><h2>Relat√≥rios RH</h2></div>
          <div class="md-card">
            <form id="form-relatorios" class="grid-form" onsubmit="event.preventDefault()">
              <div class="md-field"><label>Obra</label><select id="relatorio-obra"></select></div>
              <div class="md-field"><label>Funcion√°rio</label><select id="relatorio-funcionario"></select></div>
              <div class="md-field">
                <label>Tipo de Per√≠odo</label>
                <select id="relatorio-tipo" onchange="atualizarFiltrosRelatorio()">
                  <option value="quinzena">Intervalo de datas</option>
                  <option value="mensal" selected>Mensal</option>
                  <option value="anual">Anual</option>
                </select>
              </div>
              <div id="filtro-quinzena" class="span-all grid-form" style="display:none; margin:0; padding:0;">
                <div class="md-field"><label>Data In√≠cio</label><input type="date" id="rel-q-inicio"></div>
                <div class="md-field"><label>Data Fim</label><input type="date" id="rel-q-fim"></div>
              </div>
              <div id="filtro-mensal" class="span-all grid-form" style="display:flex; margin:0; padding:0;">
                <div class="md-field">
                  <label>M√™s</label>
                  <select id="rel-mes">
                    <option value="1">Janeiro</option><option value="2">Fevereiro</option>
                    <option value="3">Mar√ßo</option><option value="4">Abril</option>
                    <option value="5">Maio</option><option value="6">Junho</option>
                    <option value="7">Julho</option><option value="8">Agosto</option>
                    <option value="9">Setembro</option><option value="10">Outubro</option>
                    <option value="11">Novembro</option><option value="12">Dezembro</option>
                  </select>
                </div>
                <div class="md-field"><label>Ano</label><input type="number" id="rel-ano-mensal" placeholder="2025"></div>
              </div>
              <div id="filtro-anual" style="display:none;">
                <div class="md-field"><label>Ano</label><input type="number" id="rel-ano" placeholder="2025"></div>
              </div>
              <div class="md-actions span-all" style="display:flex; gap:10px; flex-wrap:wrap;">
                <button type="button" class="btn-primary" onclick="gerarRelatorioTela()">
                  <span class="material-symbols-outlined" style="font-size:16px;">visibility</span> Visualizar
                </button>
                <button type="button" class="btn-secondary" onclick="baixarFolhaExcel()">
                  <span class="material-symbols-outlined" style="font-size:16px;">table_view</span> Excel
                </button>
                <button type="button" class="btn-secondary" onclick="baixarFolhaPDF()">
                  <span class="material-symbols-outlined" style="font-size:16px;">picture_as_pdf</span> Folha PDF
                </button>
                <button type="button" class="btn-secondary" onclick="baixarContracheques()">
                  <span class="material-symbols-outlined" style="font-size:16px;">receipt_long</span> Recibos
                </button>
                <button type="button" class="btn-ghost" onclick="gerarRelatorioFinanceiroObra()">
                  <span class="material-symbols-outlined" style="font-size:16px;">paid</span> Custo Obra
                </button>
                <button type="button" class="btn-ghost" onclick="baixarCustoObraPDF()">PDF Custo</button>
                <button type="button" class="btn-ghost" onclick="baixarCustoObraExcel()">Excel Custo</button>
              </div>
            </form>
          </div>
          <div class="md-card mt-4">
            <div class="table-wrapper">
              <table class="md-table" id="tabela-relatorio">
                <thead><tr><th>Dados do Funcion√°rio</th><th>Obra</th><th>Dias / Extras</th><th>Valor L√≠quido</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
            <div style="text-align:right; font-size:16px; font-weight:700; margin-top:14px;">
              Total: <span id="relatorio-total" style="color:#1e88e5;">R$ 0,00</span>
            </div>
          </div>
        </section>

        <!-- ==================== DI√ÅRIO ==================== -->
        <section id="sec-diario" class="md-section">
          <div class="md-section-header"><h2>Di√°rio de Obras</h2></div>

          <div class="md-card" id="card-edit-diario" style="display:none; border-left:4px solid #f59e0b;">
            <h3 style="color:#d97706;">
              <span class="material-symbols-outlined" style="font-size:18px;">edit</span> Editar Registro do Di√°rio
            </h3>
            <form id="form-diario-admin">
              <input type="hidden" id="diario-admin-id">
              <div class="grid-form">
                <div class="md-field">
                  <label>Data</label>
                  <input type="date" id="diario-admin-data" readonly>
                </div>
                <div class="md-field">
                  <label>Condi√ß√µes Clim√°ticas</label>
                  <select id="diario-admin-clima">
                    <option value="Ensolarado">‚òÄÔ∏è Ensolarado</option>
                    <option value="Nublado">‚õÖ Nublado</option>
                    <option value="Chuvoso">üåßÔ∏è Chuvoso</option>
                    <option value="Vari√°vel">üå§Ô∏è Vari√°vel</option>
                  </select>
                </div>
              </div>
              <div class="md-field" style="margin-top:12px;">
                <label>Resumo das Atividades</label>
                <textarea id="diario-admin-resumo" rows="4"></textarea>
              </div>
              <div class="md-actions" style="margin-top:12px;">
                <button type="button" class="btn-primary" onclick="salvarEdicaoDiarioAdmin()">
                  <span class="material-symbols-outlined" style="font-size:16px;">save</span> Salvar
                </button>
                <button type="button" class="btn-ghost" onclick="cancelarEdicaoDiario()">Cancelar</button>
              </div>
            </form>
          </div>

          <div class="md-card mt-4">
            <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:flex-end;">
              <div class="md-field" style="flex:1; min-width:150px;"><label>Obra</label><select id="admin-diario-obra"><option value="">Todas</option></select></div>
              <div class="md-field" style="flex:1; min-width:130px;"><label>Per√≠odo</label><input type="month" id="admin-diario-mes"></div>
              <button class="btn-primary" onclick="carregarDiariosAdmin()" style="height:40px;">
                <span class="material-symbols-outlined" style="font-size:16px;">filter_alt</span> Filtrar
              </button>
              <button class="btn-secondary" onclick="baixarDiarioPDF()" style="height:40px;">
                <span class="material-symbols-outlined" style="font-size:16px;">picture_as_pdf</span> PDF
              </button>
            </div>
          </div>

          <div class="md-card mt-4">
            <div class="table-wrapper">
              <table class="md-table">
                <thead>
                  <tr>
                    <th style="width:100px;">Data</th>
                    <th>Obra</th>
                    <th>Clima</th>
                    <th>Resumo</th>
                    <th style="text-align:center; width:150px;">Fotos / A√ß√µes</th>
                  </tr>
                </thead>
                <tbody id="tabela-diarios"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- ==================== MATERIAIS ==================== -->
        <section id="sec-materiais" class="md-section">
          <div class="md-section-header"><h2>Controle de Materiais</h2></div>
          <div class="md-card">
            <div class="tab-bar">
              <div class="tab-item active" data-status="Pendente" onclick="carregarMateriaisAdmin('Pendente')">
                <span class="material-symbols-outlined" style="font-size:16px;vertical-align:middle;margin-right:4px;">pending</span>Pendentes
              </div>
              <div class="tab-item" data-status="Comprado" onclick="carregarMateriaisAdmin('Comprado')">
                <span class="material-symbols-outlined" style="font-size:16px;vertical-align:middle;margin-right:4px;">shopping_cart</span>Comprados
              </div>
              <div class="tab-item" data-status="Entregue" onclick="carregarMateriaisAdmin('Entregue')">
                <span class="material-symbols-outlined" style="font-size:16px;vertical-align:middle;margin-right:4px;">check_circle</span>Entregues
              </div>
            </div>
            <div class="table-wrapper">
              <table class="md-table">
                <thead>
                  <tr>
                    <th>Data</th><th>Obra / Req.</th><th>Item</th><th>Qtd.</th>
                    <th>Urg√™ncia</th><th>Status</th><th>A√ß√£o</th>
                  </tr>
                </thead>
                <tbody id="tabela-materiais"></tbody>
              </table>
            </div>
          </div>
        </section>

      </section>
    </main>
  </div>

  <script>
    function mostrarSecao(secao) {
      // Delegada ao utils.js ap√≥s DOMContentLoaded
      if (typeof window._mostrarSecao === "function") {
        window._mostrarSecao(secao);
      } else {
        const secoes = ["dashboard","obras","funcoes","funcionarios","ponto","usuarios","caixa","relatorios","diario","materiais"];
        secoes.forEach(id => {
          const el = document.getElementById("sec-" + id);
          if (!el) return;
          el.classList.toggle("active", id === secao);
        });
        document.querySelectorAll(".menu-item[data-target]").forEach(i => {
          i.classList.toggle("active", i.getAttribute("data-target") === secao);
        });
        const bc = document.getElementById("header-breadcrumb");
        if (bc) {
          const mi = document.querySelector(`.menu-item[data-target="${secao}"] span:last-child`);
          if (mi) bc.textContent = mi.textContent;
        }
        const content = document.querySelector(".md-content");
        if (content) content.scrollTop = 0;
        const sidebar = document.getElementById("main-sidebar");
        const overlay = document.querySelector(".sidebar-overlay");
        if (sidebar?.classList.contains("open")) {
          sidebar.classList.remove("open");
          overlay?.classList.remove("active");
        }
      }
    }

    function atualizarFiltrosRelatorio() {
      const tipo = document.getElementById("relatorio-tipo")?.value;
      if (!tipo) return;
      document.getElementById("filtro-quinzena").style.display = tipo === "quinzena" ? "flex" : "none";
      document.getElementById("filtro-mensal").style.display   = tipo === "mensal"   ? "flex" : "none";
      document.getElementById("filtro-anual").style.display    = tipo === "anual"    ? "block" : "none";
    }

    // Atualiza chip do usu√°rio no header ap√≥s carregamento
    window.addEventListener("DOMContentLoaded", () => {
      mostrarSecao("dashboard");
      atualizarFiltrosRelatorio();

      // Delegar mostrarSecao ao utils.js quando dispon√≠vel
      window._mostrarSecao = window.mostrarSecao;
    });
  </script>
</body>
</html>
